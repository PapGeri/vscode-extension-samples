import { TextDocument } from 'vscode-languageserver-textdocument';
import { P4grammarLexer } from '../antlr_autogenerated/P4grammarLexer';
import { CharStreams, CommonTokenStream, ParserRuleContext } from 'antlr4ts';
import { P4grammarParser } from '../antlr_autogenerated/P4grammarParser';
import { ParseTreeWalker } from 'antlr4ts/tree/ParseTreeWalker';
import { MyListener } from './MyListener';

export let MY_LISTENER: MyListener | null = null;

export function getDataFromAntlr(document: TextDocument) {
	if(MY_LISTENER === null){
		MY_LISTENER = new MyListener();
	}

	const lexer = new P4grammarLexer(CharStreams.fromString(document.getText()))
	const token = new CommonTokenStream(lexer);
	const parser = new P4grammarParser(token);

	parser.buildParseTree = true;
	const tree = parser.start();

	let ruleNames: string[] = parser.ruleNames;

	ParseTreeWalker.DEFAULT.walk(MY_LISTENER, tree)

	// const walker = new ParseTreeWalker();
	// walker.walk(MY_LISTENER, tree);
}